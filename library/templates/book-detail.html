{% extends 'base.html' %}
{% block title%}Title{% endblock %}
{% block content %}

<!-- BOOK INFO -->
<div>
    <h1>{{ book.title }}</h1>
    <h3>{{ book.book_id }}</h3>
    {% if book.is_available %}
    <p style="color: green;">Available</p>
    {% else %}
    <p style="color: red;">Not available</p>
    {% endif %}
    <img src="{{ book.image.url }}">
    <h3>
        Rating: {{ book.get_average_rating }}
    </h3>
</div>

<!-- ALL COMMENTS -->
{% for comment in comments %}
<h3>{{comment.student}}</h3>
<h6>{{comment.date}}</h6>
<p>{{comment.body}}</p>
{% endfor %}

<!-- ADD COMMENT -->
<form method="post" enctype="multipart/form-data">
    <div class="mb-3">
        {{ comment_form.as_p }}
        {% csrf_token %}
    </div>
 <button type="submit">Add comment</button>
</form>

<!-- ADD RATING -->
<form method="post" enctype="multipart/form-data">
    <div>
        <i class="far fa-star" id="star-1"></i>
        <i class="far fa-star" id="star-2"></i>
        <i class="far fa-star" id="star-3"></i>
        <i class="far fa-star" id="star-4"></i>
        <i class="far fa-star" id="star-5"></i>
    </div>

{{ rating_form.as_p }}
<p id="my_rating" hidden>{{my_rating}}</p>
 {% csrf_token %}
 <button type="submit" id="rating-button" hidden>Add rating</button>
</form>

<!-- ADD ORDER -->
{% if book.is_available %}
<form method="post">
    {% csrf_token %}
    <button type="submit">Take book</button>
</form>
{% endif %}

<script>
    // bootstrap css
    let comment_label = $("[for=\"id_body\"]")
    comment_label.addClass("form-label")
    let comment_textarea = $("textarea")
    comment_textarea.addClass("form-control")
    comment_textarea.css('width', 300)

    let rating_label = $("[for=\"id_rating\"]")
    rating_label.empty()


    // RATING
    let my_rating = $("#my_rating").text()
    let rating_button = $("#rating-button")
    let rating = $("[name=\"rating\"]")
    rating.prop('hidden', true)

    let option1 = $("[value=\"1\"]")
    let option2 = $("[value=\"2\"]")
    let option3 = $("[value=\"3\"]")
    let option4 = $("[value=\"4\"]")
    let option5 = $("[value=\"5\"]")

    let star1 = $("#star-1")
    let star2 = $("#star-2")
    let star3 = $("#star-3")
    let star4 = $("#star-4")
    let star5 = $("#star-5")

    // show my rating
    if (my_rating){
        if (my_rating === "1"){
            star1.toggleClass("fas")
        }
        if (my_rating === "2"){
            star1.toggleClass("fas")
            star2.toggleClass("fas")
        }
        if (my_rating === "3"){
            star1.toggleClass("fas")
            star2.toggleClass("fas")
            star3.toggleClass("fas")
        }
        if (my_rating === "4"){
            star1.toggleClass("fas")
            star2.toggleClass("fas")
            star3.toggleClass("fas")
            star4.toggleClass("fas")
        }
        if (my_rating === "5"){
            star1.toggleClass("fas")
            star2.toggleClass("fas")
            star3.toggleClass("fas")
            star4.toggleClass("fas")
            star5.toggleClass("fas")
        }
    }

    // // animation
    // star1.on("mouseenter", (e) => {star1.toggleClass("fas");star1.toggleClass("far");}).on("mouseleave", (e) => {star1.toggleClass("fas");star1.toggleClass("far");})
    // star2.on("mouseenter", (e) => {star1.toggleClass("fas");star1.toggleClass("far");star2.toggleClass("fas");star2.toggleClass("far");}).on("mouseleave", (e) => {star1.toggleClass("fas");star1.toggleClass("far");star2.toggleClass("fas");star2.toggleClass("far");})
    // star3.on("mouseenter", (e) => {star1.toggleClass("fas");star1.toggleClass("far");star2.toggleClass("fas");star2.toggleClass("far");star3.toggleClass("fas");star3.toggleClass("far");}).on("mouseleave", (e) => {star1.toggleClass("fas");star1.toggleClass("far");star2.toggleClass("fas");star2.toggleClass("far");star3.toggleClass("fas");star3.toggleClass("far");})
    // star4.on("mouseenter", (e) => {star1.toggleClass("fas");star1.toggleClass("far");star2.toggleClass("fas");star2.toggleClass("far");star3.toggleClass("fas");star3.toggleClass("far");star4.toggleClass("fas");star4.toggleClass("far");}).on("mouseleave", (e) => {star1.toggleClass("fas");star1.toggleClass("far");star2.toggleClass("fas");star2.toggleClass("far");star3.toggleClass("fas");star3.toggleClass("far");star4.toggleClass("fas");star4.toggleClass("far");})
    // star5.on("mouseenter", (e) => {star1.toggleClass("fas");star1.toggleClass("far");star2.toggleClass("fas");star2.toggleClass("far");star3.toggleClass("fas");star3.toggleClass("far");star4.toggleClass("fas");star4.toggleClass("far");star5.toggleClass("fas");star5.toggleClass("far");}).on("mouseleave", (e) => {star1.toggleClass("fas");star1.toggleClass("far");star2.toggleClass("fas");star2.toggleClass("far");star3.toggleClass("fas");star3.toggleClass("far");star4.toggleClass("fas");star4.toggleClass("far");star5.toggleClass("fas");star5.toggleClass("far");})

    star1.on("click", (e) => {option1.prop('selected', true);rating_button.click()})
    star2.on("click", (e) => {option2.prop('selected', true);rating_button.click()})
    star3.on("click", (e) => {option3.prop('selected', true);rating_button.click()})
    star4.on("click", (e) => {option4.prop('selected', true);rating_button.click()})
    star5.on("click", (e) => {option5.prop('selected', true);rating_button.click()})


</script>

{% endblock %}